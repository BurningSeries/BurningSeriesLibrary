!function(e,i){i.BurningSeries={baseUrl:"http://bs.to/serie/",baseApiUrl:"http://bs.to/api/",coverUrl:"//s.bs.to/img/cover/{id}.jpg",sessionId:null,SORT_ALPHABETICAL:0,SORT_GENRE:1,SORT_NEWEST:2,ANDROID:"android",calls:0,postCalls:0,enableCaching:!0,cache:{},dontCache:["watch","unwatch","user/series/set","login","logout"],search:function(e,i,n){"undefined"==typeof n&&(n=i,i=!1),this.getSeries(function(t){var r=[];for(var s in t)i||-1==t[s].series.toLowerCase().indexOf(e.toLowerCase())?i&&t[s].series.toLowerCase()==e.toLowerCase()&&r.push(t[s]):r.push(t[s]);i&&1==r.length?r=r[0]:i&&r.length>1&&(r={}),BurningSeries.callCallback(n,r)})},getByName:function(e,i){this.search(e,!0,function(e){return 0==e.length?void BurningSeries.callCallback(i,{}):void BurningSeries.getSerie(e.id,i)})},buildSerieUrl:function(e,i){this.getSerieObject(e,function(e){return"undefined"==typeof e||0==e.length?void BurningSeries.callCallback(i,""):void BurningSeries.callCallback(i,BurningSeries.buildLink(e.url))})},buildSeasonUrl:function(e,i,n){i=parseInt(i),this.buildSerieUrl(e,function(e){BurningSeries.callCallback(n,e+"/"+i)})},buildEpisodeUrl:function(e,i,n,t){n=parseInt(n),this.buildSeasonUrl(e,i,function(e){BurningSeries.callCallback(t,e+"/"+n+"-Episode")})},buildUrl:function(e,i,n,t){"undefined"!=typeof t?this.buildEpisodeUrl(e,i,n,t):"undefined"!=typeof i?this.buildSeasonUrl(e,i,n):this.buildEpisodeUrl(e,i)},getCover:function(e,i){this.getSerieObject(e,function(e){BurningSeries.callCallback(i,BurningSeries.coverUrl.replace("{id}",e.id))})},getGenres:function(e){this.getSeries(this.SORT_GENRE,function(i){var n=[];for(var t in i)n.push(t);BurningSeries.callCallback(e,n)})},hasWatched:function(e,i,n,t){null==this.sessionId&&this.callCallback(t,!1),this.getSerieObject(e,function(e){BurningSeries.getSeason(e.id,i,function(e){n=parseInt(n);for(var i in e)if(e[i].epi==n){var r=1==e[i].watched?!0:!1;return void BurningSeries.callCallback(t,r)}BurningSeries.callCallback(t,!1)})})},getNextUnwatchedEpisode:function(e,i,n,t){alert("Not yet implemented")},getNextUnwatchedMovie:function(e,i){this.getNextUnwatchedEpisode(e,0,i)},markAsFavorite:function(i,n){return null==this.sessionId?void this.callCallback(n,!1):void this.getSerieObject(i,function(i){BurningSeries.getFavoriteSeries(function(t){var r=[];for(var s in t)r.push(t[s].id);return-1!=e.inArray(i.id,r)?void BurningSeries.callCallback(n,!0):(r.push(i.id),void BurningSeries.callCallback(n,BurningSeries.setFavoriteSeries(r)))})})},unmarkAsFavorite:function(e,i){return null==this.sessionId?void BurningSeries.callCallback(i,!1):void this.getSerieObject(e,function(e){BurningSeries.getFavoriteSeries(function(n){var t=[],r=!1;for(var s in n)n[s].id!=e.id?t.push(n[s].id):r=!0;return r?void BurningSeries.callCallback(i,BurningSeries.setFavoriteSeries(t)):void BurningSeries.callCallback(i,!0)})})},isFavoritedSerie:function(e,i){return null==this.sessionId?!1:void this.getSerieObject(e,function(e){BurningSeries.getFavoriteSeries(function(n){for(var t in n)if(n[t].id==e.id)return void BurningSeries.callCallback(i,!0);BurningSeries.callCallback(i,!1)})})},getSeries:function(e,i){"undefined"==typeof i&&(i=e,e=this.SORT_ALPHABETICAL);var n="series";e==this.SORT_GENRE&&(n="series:genre");var t=i;e==this.SORT_NEWEST&&(t=function(e){e=BurningSeries.sortById(e),BurningSeries.callCallback(i,e)}),this.call(n,t)},getByGenre:function(e,i){this.getSeries(this.SORT_GENRE,function(n){if(parseInt(e)==e&&(e=parseInt(e)),"string"==typeof e)return n.hasOwnProperty(e)?void BurningSeries.callCallback(i,n[e]):void BurningSeries.callCallback(i,[]);if(Number.isInteger(e))for(var t in n)if(n[t].id==e)return void BurningSeries.callCallback(i,n[t]);BurningSeries.callCallback(i,[])})},getNewest:function(e){return this.getSeries(this.SORT_NEWEST,e)},getSerie:function(e,i){e=parseInt(e),this.call("series/"+e+"/1",function(e){return"undefined"==typeof e.series?void BurningSeries.callCallback(i,{}):void BurningSeries.callCallback(i,e.series)})},getSeason:function(e,i,n){e=parseInt(e),i=parseInt(i),this.call("series/"+e+"/"+i,function(e){return"undefined"==typeof e.epi?void BurningSeries.callCallback(n,[]):void BurningSeries.callCallback(n,e.epi)})},getMovies:function(e,i){this.getSeason(e,0,i)},getEpisode:function(e,i,n,t){e=parseInt(e),i=parseInt(i),n=parseInt(n),this.call("series/"+e+"/"+i+"/"+n,function(e){return"undefined"==typeof e.epi?void BurningSeries.callCallback(t,{}):void BurningSeries.callCallback(t,e.epi)})},get:function(e,i,n,t){"undefined"!=typeof t?this.getEpisode(e,i,n,t):"undefined"!=typeof n?this.getSeason(e,i,n):this.getSerie(e,i)},getHoster:function(e,i,n,t){e=parseInt(e),i=parseInt(i),n=parseInt(n),this.call("series/"+e+"/"+i+"/"+n,function(e){return"undefined"==typeof e.links?void BurningSeries.callCallback(t,[]):void BurningSeries.callCallback(t,e.links)})},getVideo:function(e,i){e=parseInt(e),this.call("watch/"+e,i,void 0,!1)},markAsWatched:function(e,i,n){return null==this.sessionId?!1:("undefined"!=typeof i&&"undefined"!=typeof n&&this.getHoster(e,i,n,function(e){var i=e[Math.floor(Math.random()*e.length)];BurningSeries.markAsWatched(i.id)}),e=parseInt(e),this.call("watch/"+e),!0)},markAsUnwatched:function(e,i,n,t){return null==this.sessionId?(BurningSeries.callCallback(t,!1),!1):"undefined"!=typeof i&&"undefined"!=typeof n?void this.getEpisode(e,i,n,function(e){BurningSeries.markAsUnwatched(e.id,t)}):(t=i,"undefined"!=typeof e.id&&(e=e.id),e=parseInt(e),void this.call("unwatch/"+e,function(e){BurningSeries.callCallback(t,e.success)}))},getFavoriteSeries:function(e){return null==this.sessionId?void BurningSeries.callCallback(e,[]):void this.call("user/series",e)},setFavoriteSeries:function(e){return null==this.sessionId?!1:(e=e.join(),0==e.length&&(e=0),this.call("user/series/set/"+e),!0)},login:function(e,i,n){if("string"!=typeof e||"string"!=typeof i)return void alert("Name and Password need to be strings");var t={"login[user]":e,"login[pass]":i};this.call("login",function(e){console.log(e),BurningSeries.setSessionId(e.session),BurningSeries.callCallback(n,e.session)},t)},logout:function(){this.call("logout"),this.setSessionId()},getVersion:function(e,i){this.call("version/"+e,function(e){return"undefined"==typeof e.version?void BurningSeries.callCallback(i,!1):void BurningSeries.callCallback(i,e.version)})},init:function(e,i){"undefined"!=typeof e&&("undefined"!=typeof i?this.login(e,i):this.setSessionId(e))},setBaseUrl:function(e){""!=e&&(this.baseUrl=e)},getBaseUrl:function(){return this.baseUrl},setApiFunction:function(e){""!=e&&(this.baseApiUrl=e)},getApiUrl:function(){return this.baseApiUrl},setCoverUrl:function(e){""!=e&&-1!=e.indexOf("{id}")&&(this.coverUrl=e)},getCoverUrl:function(){return this.coverUrl},setSessionId:function(e){"undefined"==typeof e&&(e=null),this.sessionId=e},getSessionId:function(){return this.sessionId},buildLink:function(e){return this.baseUrl+e},getSerieObject:function(e,i){return"undefined"!=typeof e.id?void BurningSeries.callCallback(i,e):Number.isInteger(e)?void this.getSerie(e,function(e){0==e.length&&alert("Error getting the series"),BurningSeries.callCallback(i,e)}):"string"==typeof e?void this.search(e,!0,function(n){return 0==n.length?parseInt(e)==e?void BurningSeries.getSerieObject(parseInt(e),i):void alert("Couldn't find a Serie with that name"):void BurningSeries.getSerie(n.id,i)}):void alert("Serie needs to be either an integer, a string or an array")},call:function(i,n,t,r){if(this.isCaching()&&this.shouldBeCached(i)&&this.hasCache(i)&&"undefined"==typeof t)return void BurningSeries.callCallback(n,this.getCache(i));var s=i;i=this.baseApiUrl+i,null===this.sessionId||"undefined"!=typeof r&&1!=r||(i+="?s="+this.sessionId),this.calls++;var a="post";"undefined"==typeof t&&(a="get",t=[],this.postCalls++),e.ajax({data:t,dataType:"json",type:a,url:i,success:function(e){BurningSeries.isCaching()&&BurningSeries.shouldBeCached(s)&&"post"!=a&&BurningSeries.putCache(s,e),BurningSeries.callCallback(n,e)}})},callCallback:function(e,i){"function"==typeof e&&e(i)},sortById:function(e){var i=[];for(var n in e)i.push([n,e[n]]);i.sort(function(e,i){return i[1].id-e[1].id});var t=[];for(var n in i)t.push(i[n][1]);return t},putCache:function(e,i){this.cache[e]=i},hasCache:function(e){return"undefined"!=typeof this.cache[e]},getCache:function(e){return this.cache[e]},shouldBeCached:function(i){if(-1!=e.inArray(i,this.dontCache))return!1;for(var n in this.dontCache){var t=this.dontCache[n];if(0===i.indexOf(t))return!1}return!0},invalidateCache:function(e){"undefined"==typeof e?this.cache={}:this.cache[e]=void 0},disableCache:function(){this.enableCaching=!1},enableCache:function(){this.enableCaching=!0},isCaching:function(){return this.enableCaching},getNumCalls:function(){return this.calls},getNumPostCalls:function(){return this.postCalls},getNumGetCalls:function(){return this.calls-this.postCalls}}}(jQuery,window);
